<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Rory Nolan" />

<meta name="date" content="2017-02-20" />

<title>exampletestr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">exampletestr</h1>
<h4 class="author"><em>Rory Nolan</em></h4>
<h4 class="date"><em>2017-02-20</em></h4>



<div id="in-a-nutshell" class="section level2">
<h2>In a nutshell</h2>
<p>The primary use of <code>exampletestr</code> is from every file in the <code>R/</code> directory of a package, to create a corresponding <em>shell</em> of a test file (something to get you started making tests (for use with <code>testthat</code>)) that will have to be filled in to create a fully functioning test file. This can be done for the whole package at once with <code>make_tests_shells_pkg()</code> or for individual files with <code>make_tests_shells_file()</code>. These tests are created by using the examples in the roxygen documentation of your package (yes, you must use <code>roxygen2</code> to use this package) as a basis for tests. I have often (but not always) found that I test my functions manually by making sure my examples work as intended, so why not use these as a basis for proper unit testing?</p>
</div>
<div id="out-of-the-nutshell" class="section level2">
<h2>Out of the nutshell</h2>
<p>First, let’s set up a dummy package directory with just the <code>utils.R</code> file from the source code of the <code>exampletestr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(exampletestr)
<span class="kw">library</span>(testthat)
if (<span class="kw">dir.exists</span>(<span class="st">&quot;tempkg&quot;</span>)) <span class="kw">warning</span>(<span class="st">&quot;Do not proceed, you'll mess with your &quot;</span>,
<span class="st">&quot;'tempkg' folder.&quot;</span>)
<span class="kw">dir.create</span>(<span class="st">&quot;tempkg&quot;</span>)
devtools::<span class="kw">create</span>(<span class="st">&quot;tempkg&quot;</span>)</code></pre></div>
<pre><code>## Creating package 'tempkg' in '/Users/rnolan/Dropbox/DPhil/Misc/RStuff/exampletestr/vignettes'</code></pre>
<pre><code>## No DESCRIPTION found. Creating with values:</code></pre>
<pre><code>## Package: tempkg
## Title: What the Package Does (one line, title case)
## Version: 0.0.0.9000
## Authors@R: person(&quot;First&quot;, &quot;Last&quot;, email = &quot;first.last@example.com&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;))
## Description: What the package does (one paragraph).
## Depends: R (&gt;= 3.3.2)
## License: What license is it under?
## Encoding: UTF-8
## LazyData: true</code></pre>
<pre><code>## * Creating `tempkg.Rproj` from template.</code></pre>
<pre><code>## * Adding `.Rproj.user`, `.Rhistory`, `.RData` to ./.gitignore</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">use_testthat</span>(<span class="st">&quot;tempkg&quot;</span>)</code></pre></div>
<pre><code>## * Adding testthat to Suggests</code></pre>
<pre><code>## * Creating `tests/testthat`.</code></pre>
<pre><code>## * Creating `tests/testthat.R` from template.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">file.copy</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;exampletestr.R&quot;</span>, <span class="st">&quot;utils.R&quot;</span>), <span class="dt">package =</span> <span class="st">&quot;exampletestr&quot;</span>), 
          <span class="st">&quot;tempkg/R&quot;</span>)</code></pre></div>
<pre><code>## [1] TRUE TRUE</code></pre>
<p>The <code>utils.R</code> file looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' Does evaluation of text give an error?</span>
<span class="co">#'</span>
<span class="co">#' Can a character vector (where each line is treated as a line of R code) be</span>
<span class="co">#' evaluated as an R expression (or several R expressions) without giving an</span>
<span class="co">#' error?</span>
<span class="co">#'</span>
<span class="co">#' @param text_expr The expression to be evaluated, as a character vector.</span>
<span class="co">#'</span>
<span class="co">#' @return `TRUE` if the code gives an error and `FALSE` otherwise.</span>
<span class="co">#' @examples</span>
<span class="co">#' text_eval_error(&quot;a &lt;- 1&quot;)</span>
<span class="co">#' text_eval_error(&quot;a &lt;- &quot;)</span>
<span class="co">#' @export</span>
text_eval_error &lt;-<span class="st"> </span>function(text_expr) {
  <span class="kw">try</span>(<span class="kw">parse</span>(<span class="dt">text =</span> text_expr), <span class="dt">silent =</span> <span class="ot">TRUE</span>) %&gt;%<span class="st"> </span><span class="kw">inherits</span>(<span class="st">&quot;try-error&quot;</span>)
}

<span class="co">#' Text expression groups.</span>
<span class="co">#'</span>
<span class="co">#' Given a character vector of R expressions, break the vector up into groups of</span>
<span class="co">#' lines, where each group of lines is a valid R expression.</span>
<span class="co">#'</span>
<span class="co">#' @param text_expr A character vector.</span>
<span class="co">#'</span>
<span class="co">#' @return A list of character vectors, each of which can be evaluated as a</span>
<span class="co">#'   valid R expression.</span>
<span class="co">#' @examples</span>
<span class="co">#' text_expr &lt;- c(&quot;a &lt;- 1&quot;,</span>
<span class="co">#' &quot;fx &lt;- function(x) {&quot;,</span>
<span class="co">#' &quot;paste('f', x)&quot;,</span>
<span class="co">#' &quot;}&quot;)</span>
<span class="co">#' extract_expressions(text_expr)</span>
<span class="co">#' @export</span>
extract_expressions &lt;-<span class="st"> </span>function(text_expr) {
  expr_groups &lt;-<span class="st"> </span><span class="kw">list</span>()
  i &lt;-<span class="st"> </span><span class="dv">1</span>
  while (i &lt;=<span class="st"> </span><span class="kw">length</span>(text_expr)) {
    j &lt;-<span class="st"> </span><span class="dv">0</span>
    expr &lt;-<span class="st"> </span>text_expr[i]
    while(<span class="kw">text_eval_error</span>(expr)) {
      j &lt;-<span class="st"> </span>j +<span class="st"> </span><span class="dv">1</span>
      expr &lt;-<span class="st"> </span>text_expr[i:(i +<span class="st"> </span>j)]
    }
    expr_groups &lt;-<span class="st"> </span><span class="kw">append</span>(expr_groups, <span class="kw">list</span>(expr))
    i &lt;-<span class="st"> </span>i +<span class="st"> </span>j +<span class="st"> </span><span class="dv">1</span>
  }
  expr_groups
}

<span class="co">#' Evaluate a text string</span>
<span class="co">#'</span>
<span class="co">#' @param string The string to evaluate (as if it were a command).</span>
<span class="co">#'</span>
<span class="co">#' @examples</span>
<span class="co">#' TextEval(&quot;3 + 4&quot;)</span>
<span class="co">#' to.be.evaluated &lt;- &quot;var(c(1, 6, 8))&quot;</span>
<span class="co">#' TextEval(to.be.evaluated)</span>
<span class="co">#'</span>
<span class="co">#' @export</span>
TextEval &lt;-<span class="st"> </span>function(string) {
  <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(string) &amp;&amp;<span class="st"> </span><span class="kw">length</span>(string) ==<span class="st"> </span><span class="dv">1</span>)
  <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> string))
}

<span class="co">#' Construct an `expect_equal` expression</span>
<span class="co">#'</span>
<span class="co">#' Construct an `expect_equal` expression from a character vector</span>
<span class="co">#' containing an expression to be evaluated.</span>
<span class="co">#'</span>
<span class="co">#' @param text_expr A character vector of lines that, when executed produce a</span>
<span class="co">#'   single output.</span>
<span class="co">#'</span>
<span class="co">#' @return A character vector. The lines of text containing the</span>
<span class="co">#'   `expect_equal` code corresponding to the input, which will help to</span>
<span class="co">#'   write the test file based on an example detailed with roxgen. Remember that</span>
<span class="co">#'   this is something that you're intended to fill the gaps in later.</span>
<span class="co">#'</span>
<span class="co">#' @examples</span>
<span class="co">#' text_expr &lt;- c(&quot;sum(1, &quot;, &quot;2)&quot;)</span>
<span class="co">#' cat(paste(text_expr, collapse = &quot;\n&quot;))</span>
<span class="co">#' construct_expect_equal(text_expr)</span>
<span class="co">#' cat(paste(construct_expect_equal(text_expr), collapse = &quot;\n&quot;))</span>
<span class="co">#' @export</span>
construct_expect_equal &lt;-<span class="st"> </span>function(text_expr) {
  text_expr[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;expect_equal(&quot;</span>, text_expr[<span class="dv">1</span>])
  l &lt;-<span class="st"> </span><span class="kw">length</span>(text_expr)
  text_expr[l] &lt;-<span class="st"> </span><span class="kw">paste0</span>(text_expr[l], <span class="st">&quot;, )&quot;</span>)
  text_expr
}</code></pre></div>
<p>So let’s demonstrate <code>extract_examples</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">extract_examples</span>(<span class="st">&quot;utils&quot;</span>, <span class="dt">pkg_dir =</span> <span class="st">&quot;tempkg&quot;</span>)</code></pre></div>
<pre><code>## $text_eval_error
## [1] &quot;text_eval_error(\&quot;a &lt;- 1\&quot;)&quot; &quot;text_eval_error(\&quot;a &lt;- \&quot;)&quot; 
## 
## $extract_expressions
## [1] &quot;text_expr &lt;- c(\&quot;a &lt;- 1\&quot;,&quot;     &quot;\&quot;fx &lt;- function(x) {\&quot;,&quot;      
## [3] &quot;\&quot;paste('f', x)\&quot;,&quot;             &quot;\&quot;}\&quot;)&quot;                        
## [5] &quot;extract_expressions(text_expr)&quot;
## 
## $TextEval
## [1] &quot;TextEval(\&quot;3 + 4\&quot;)&quot;                   
## [2] &quot;to.be.evaluated &lt;- \&quot;var(c(1, 6, 8))\&quot;&quot;
## [3] &quot;TextEval(to.be.evaluated)&quot;             
## 
## $construct_expect_equal
## [1] &quot;text_expr &lt;- c(\&quot;sum(1, \&quot;, \&quot;2)\&quot;)&quot;                              
## [2] &quot;cat(paste(text_expr, collapse = \&quot;\\n\&quot;))&quot;                        
## [3] &quot;construct_expect_equal(text_expr)&quot;                                
## [4] &quot;cat(paste(construct_expect_equal(text_expr), collapse = \&quot;\\n\&quot;))&quot;</code></pre>
<p>Indeed we get all of the lines of the documentation examples. Now with <code>make_test_shell</code>, we turn it into something usable with <code>testthat</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(<span class="kw">extract_examples</span>(<span class="st">&quot;utils&quot;</span>, <span class="dt">pkg_dir =</span> <span class="st">&quot;tempkg&quot;</span>), make_test_shell, <span class="st">&quot;whatevs&quot;</span>)</code></pre></div>
<pre><code>## $text_eval_error
## [1] &quot;test_that(\&quot;whatevs\&quot;, {&quot;                     
## [2] &quot;  expect_equal(text_eval_error(\&quot;a &lt;- 1\&quot;), )&quot;
## [3] &quot;  expect_equal(text_eval_error(\&quot;a &lt;- \&quot;), )&quot; 
## [4] &quot;})&quot;                                           
## 
## $extract_expressions
## [1] &quot;test_that(\&quot;whatevs\&quot;, {&quot;                        
## [2] &quot;  text_expr &lt;- c(\&quot;a &lt;- 1\&quot;,&quot;                    
## [3] &quot;  \&quot;fx &lt;- function(x) {\&quot;,&quot;                      
## [4] &quot;  \&quot;paste('f', x)\&quot;,&quot;                            
## [5] &quot;  \&quot;}\&quot;)&quot;                                        
## [6] &quot;  expect_equal(extract_expressions(text_expr), )&quot;
## [7] &quot;})&quot;                                              
## 
## $TextEval
## [1] &quot;test_that(\&quot;whatevs\&quot;, {&quot;                   
## [2] &quot;  expect_equal(TextEval(\&quot;3 + 4\&quot;), )&quot;      
## [3] &quot;  to.be.evaluated &lt;- \&quot;var(c(1, 6, 8))\&quot;&quot;   
## [4] &quot;  expect_equal(TextEval(to.be.evaluated), )&quot;
## [5] &quot;})&quot;                                         
## 
## $construct_expect_equal
## [1] &quot;test_that(\&quot;whatevs\&quot;, {&quot;                                                           
## [2] &quot;  text_expr &lt;- c(\&quot;sum(1, \&quot;, \&quot;2)\&quot;)&quot;                                              
## [3] &quot;  expect_equal(cat(paste(text_expr, collapse = \&quot;\\n\&quot;)), )&quot;                        
## [4] &quot;  expect_equal(construct_expect_equal(text_expr), )&quot;                                
## [5] &quot;  expect_equal(cat(paste(construct_expect_equal(text_expr), collapse = \&quot;\\n\&quot;)), )&quot;
## [6] &quot;})&quot;</code></pre>
<p>This might look a little weird in the output but it’s really just</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">test_that</span>(<span class="st">&quot;whatevs&quot;</span>, {
  <span class="kw">expect_equal</span>(<span class="kw">text_eval_error</span>(<span class="st">&quot;a &lt;- 1&quot;</span>), )
  <span class="kw">expect_equal</span>(<span class="kw">text_eval_error</span>(<span class="st">&quot;a &lt;- &quot;</span>), )
})</code></pre></div>
<p>and so on, which is what we would want. Now we have something we can fill in ourselves to create a real unit test.</p>
<p>We can make the unit tests <em>shell</em> file (<em>shell</em> because it needs to be filled in) via <code>make_tests_shell_file</code>. Running</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_tests_shells_file</span>(<span class="st">&quot;utils&quot;</span>, <span class="dt">pkg_dir =</span> <span class="st">&quot;tempkg&quot;</span>)</code></pre></div>
<p>outputs a <code>test_utils.R</code> file in the <code>tests/testthat</code> folder with contents</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">test_that</span>(<span class="st">&quot;text_eval_error works&quot;</span>, {
  <span class="kw">expect_equal</span>(<span class="kw">text_eval_error</span>(<span class="st">&quot;a &lt;- 1&quot;</span>), )
  <span class="kw">expect_equal</span>(<span class="kw">text_eval_error</span>(<span class="st">&quot;a &lt;- &quot;</span>), )
})

<span class="kw">test_that</span>(<span class="st">&quot;extract_expressions works&quot;</span>, {
  text_expr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a &lt;- 1&quot;</span>,
  <span class="st">&quot;fx &lt;- function(x) {&quot;</span>,
  <span class="st">&quot;paste('f', x)&quot;</span>,
  <span class="st">&quot;}&quot;</span>)
  <span class="kw">expect_equal</span>(<span class="kw">extract_expressions</span>(text_expr), )
})

<span class="kw">test_that</span>(<span class="st">&quot;TextEval works&quot;</span>, {
  <span class="kw">expect_equal</span>(<span class="kw">TextEval</span>(<span class="st">&quot;3 + 4&quot;</span>), )
  to.be.evaluated &lt;-<span class="st"> &quot;var(c(1, 6, 8))&quot;</span>
  <span class="kw">expect_equal</span>(<span class="kw">TextEval</span>(to.be.evaluated), )
})

<span class="kw">test_that</span>(<span class="st">&quot;construct_expect_equal works&quot;</span>, {
  text_expr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sum(1, &quot;</span>, <span class="st">&quot;2)&quot;</span>)
  <span class="kw">expect_equal</span>(<span class="kw">cat</span>(<span class="kw">paste</span>(text_expr, <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)), )
  <span class="kw">expect_equal</span>(<span class="kw">construct_expect_equal</span>(text_expr), )
  <span class="kw">expect_equal</span>(<span class="kw">cat</span>(<span class="kw">paste</span>(<span class="kw">construct_expect_equal</span>(text_expr), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)), )
})</code></pre></div>
<p>which, for my purposes, I complete as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">test_that</span>(<span class="st">&quot;text_eval_error works&quot;</span>, {
  <span class="kw">expect_false</span>(<span class="kw">text_eval_error</span>(<span class="st">&quot;a &lt;- 1&quot;</span>))
  <span class="kw">expect_true</span>(<span class="kw">text_eval_error</span>(<span class="st">&quot;a &lt;- &quot;</span>))
})

<span class="kw">test_that</span>(<span class="st">&quot;extract_expressions works&quot;</span>, {
  text_expr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a &lt;- 1&quot;</span>,
  <span class="st">&quot;fx &lt;- function(x) {&quot;</span>,
  <span class="st">&quot;paste('f', x)&quot;</span>,
  <span class="st">&quot;}&quot;</span>)
  <span class="kw">expect_equal</span>(<span class="kw">extract_expressions</span>(text_expr), <span class="kw">list</span>(
    <span class="st">&quot;a &lt;- 1&quot;</span>,
    <span class="kw">c</span>(<span class="st">&quot;fx &lt;- function(x) {&quot;</span>,
      <span class="st">&quot;paste('f', x)&quot;</span>,
      <span class="st">&quot;}&quot;</span>)
  ))
})

<span class="kw">test_that</span>(<span class="st">&quot;TextEval works&quot;</span>, {
  <span class="kw">expect_equal</span>(<span class="kw">TextEval</span>(<span class="st">&quot;3 + 4&quot;</span>), <span class="dv">7</span>)
  to.be.evaluated &lt;-<span class="st"> &quot;var(c(1, 6, 8))&quot;</span>
  <span class="kw">expect_equal</span>(<span class="kw">TextEval</span>(to.be.evaluated), <span class="kw">var</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">8</span>)))
})

<span class="kw">test_that</span>(<span class="st">&quot;construct_expect_equal works&quot;</span>, {
  text_expr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sum(1, &quot;</span>, <span class="st">&quot;2)&quot;</span>)
  <span class="kw">expect_equal</span>(<span class="kw">construct_expect_equal</span>(text_expr), <span class="kw">c</span>(<span class="st">&quot;expect_equal(sum(1, &quot;</span>,
                                                    <span class="st">&quot;2), )&quot;</span>))
})</code></pre></div>
<p>To create these test shell files for each file in the <code>R/</code> directory of your package, run</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_tests_shells_pkg</span>()</code></pre></div>
<p>I would like to stress that whilst unit testing should be automatic, the creation of these tests is a manual process, a manual check. This package is supposed to help you start making those tests. It is not supposed to create fully functioning tests automatically, nor can it help you to write every type of test you might want.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
